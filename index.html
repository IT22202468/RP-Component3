<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Research 1.0 - Electron</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 40px; }
      h1 { color: #2c3e50; }
      button { padding: 10px 14px; font-size: 16px; border-radius: 6px; cursor: pointer; }
      /* Toast styles */
      .toast-container {
        position: fixed;
        right: 20px;
        bottom: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .toast {
        min-width: 280px;
        max-width: 420px;
        background: #fff;
        color: #222;
        box-shadow: 0 6px 18px rgba(0,0,0,0.12);
        border-radius: 8px;
        padding: 12px 14px;
        display: flex;
        align-items: center;
        gap: 12px;
        animation: toast-in 240ms ease;
      }
      .toast .msg {
        flex: 1 1 auto;
      }
      .toast .actions {
        display: flex;
        gap: 8px;
        flex-shrink: 0;
      }
      .toast .actions button {
        padding: 6px 10px;
        font-size: 13px;
        border-radius: 6px;
        border: 1px solid transparent;
        background: #f1f3f5;
        cursor: pointer;
      }
      .toast .actions button.primary {
        background: #2563eb;
        color: #fff;
        border-color: rgba(0,0,0,0.06);
      }
      @keyframes toast-in {
        from { transform: translateY(8px); opacity: 0 }
        to { transform: translateY(0); opacity: 1 }
      }
    </style>
  </head>
  <body>
    <h1>Research 1.0</h1>
    <p>This is a minimal Electron app for the Research project (25-26J-498).</p>
    <p>If you see this window, Electron has launched successfully.</p>

    <div style="margin-top:20px;">
      <button id="notifyBtn">Show Notification</button>
      <span id="status" style="margin-left:12px;color:#666;font-size:14px;"></span>
    </div>

    <script>
      // Use the main process Notification (via IPC) so we can add action buttons.
      const isElectron = typeof window !== 'undefined' && window.process && window.process.versions && window.process.versions.electron
      const statusEl = document.getElementById('status')

      function setStatus(msg) {
        if (statusEl) statusEl.textContent = msg
      }

      document.addEventListener('DOMContentLoaded', () => {
        const btn = document.getElementById('notifyBtn')

        if (!isElectron) {
          setStatus('Not running inside Electron; notifications will use browser API')
        }

        btn.addEventListener('click', async () => {
          const title = 'Research 1.0'
          const body = 'This is a notification from the app.'

          if (isElectron && window.require) {
            const { ipcRenderer } = require('electron')

            // Request a system notification from the main process. The main
            // handler will emit 'notification-response' when the user acts on
            // the notification (or it closes).
            ipcRenderer.once('notification-response', (ev, data) => {
              if (data && data.result) {
                setStatus('User chose: ' + data.result)
                console.log('Notification response', data)
              }
            })

            try {
              await ipcRenderer.invoke('show-notification', { title, body, useDialog: false })
            } catch (err) {
              console.error('IPC error invoking notification:', err)
              setStatus('Failed to show notification: ' + err.message)
            }
          } else {
            // Fallback to HTML5 Notification in browser
            try {
              if (Notification.permission === 'granted') {
                new Notification(title, { body })
              } else {
                const p = await Notification.requestPermission()
                setStatus('Notification permission: ' + p)
                if (p === 'granted') new Notification(title, { body })
              }
            } catch (err) {
              console.error('Browser notification failed:', err)
              alert('Notification failed: ' + err.message)
            }
          }
        })
        // (Removed: previous dialog/toast button and handler)
      })

      // ---------------------------
      // In-app toast implementation
      // ---------------------------
      function ensureToastContainer() {
        let c = document.querySelector('.toast-container')
        if (!c) {
          c = document.createElement('div')
          c.className = 'toast-container'
          document.body.appendChild(c)
        }
        return c
      }

      function showToast({ title, body, timeout = 8000 } = {}) {
        return new Promise((resolve, reject) => {
          try {
            const container = ensureToastContainer()
            const t = document.createElement('div')
            t.className = 'toast'

            const msg = document.createElement('div')
            msg.className = 'msg'
            msg.innerHTML = '<strong>' + (title || '') + '</strong><div style="font-size:13px;color:#444;margin-top:6px;">' + (body || '') + '</div>'

            const actions = document.createElement('div')
            actions.className = 'actions'

            const okBtn = document.createElement('button')
            okBtn.className = 'primary'
            okBtn.textContent = 'Okay'
            okBtn.addEventListener('click', () => {
              cleanup('okay')
            })

            const cancelBtn = document.createElement('button')
            cancelBtn.textContent = 'Cancel'
            cancelBtn.addEventListener('click', () => {
              cleanup('cancel')
            })

            actions.appendChild(okBtn)
            actions.appendChild(cancelBtn)

            t.appendChild(msg)
            t.appendChild(actions)

            container.appendChild(t)

            const tid = setTimeout(() => {
              cleanup('closed')
            }, timeout)

            function cleanup(result) {
              clearTimeout(tid)
              t.style.transition = 'opacity 180ms ease, transform 180ms ease'
              t.style.opacity = '0'
              t.style.transform = 'translateY(6px)'
              setTimeout(() => {
                try { container.removeChild(t) } catch (e) {}
                resolve(result)
              }, 200)
            }
          } catch (err) {
            reject(err)
          }
        })
      }
    </script>
  </body>
</html>
